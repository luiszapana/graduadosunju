<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Alta Interna de Graduado</title>
</head>
<body>
<div th:replace="~{layout :: layout(~{::content})}">

    <div th:fragment="content">
        <div class="container mt-4">
            <h3>Registro Completo de Graduado (Administración)</h3>

            <form th:action="@{/admin/graduados/guardar}"
                  th:object="${altaGraduadoAdminDTO}"
                  method="post"
                  enctype="multipart/form-data">

                <h5 class="mt-4 border-bottom pb-2">Datos Personales y Acceso</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Email (Usuario de Acceso)</label>
                        <input class="form-control" th:field="*{email}" type="email" required
                               th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''" />

                        <div th:if="${#fields.hasErrors('email')}" class="text-danger small">
                            <span th:errors="*{email}">Error de email</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>DNI * (Contraseña Inicial)</label>
                        <input class="form-control" th:field="*{dni}" type="text" required
                               th:classappend="${#fields.hasErrors('dni')} ? 'is-invalid' : ''" />

                        <div th:if="${#fields.hasErrors('dni')}" class="text-danger small">
                            <span th:errors="*{dni}">Error de DNI</span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Apellido</label>
                        <input class="form-control" th:field="*{apellido}" required />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>Nombre</label>
                        <input class="form-control" th:field="*{nombre}" required />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label>Fecha de Nacimiento</label>
                        <input type="date" class="form-control" th:field="*{fechaNacimiento}">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label>Teléfono</label>
                        <input class="form-control" th:field="*{telefono}" type="text" />
                    </div>
                    <div class="col-md-4 mb-3">
                        <label>Celular</label>
                        <input class="form-control" th:field="*{celular}" type="text" />
                    </div>
                </div>

                <h5 class="mt-4 border-bottom pb-2">Dirección</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Provincia</label>
                        <select class="form-select" th:field="*{provinciaId}" required>
                            <option value="">Seleccione una provincia</option>
                            <option th:each="prov : ${provincias}"
                                    th:value="${prov.id}"
                                    th:text="${prov.nombre}"></option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>Localidad</label>
                        <input type="text" class="form-control" th:field="*{localidad}" placeholder="Escriba la localidad">
                    </div>
                </div>
                <div class="mb-3">
                    <label>Domicilio</label>
                    <input type="text" class="form-control" th:field="*{domicilio}" placeholder="Barrio, calle y número">
                </div>

                <h5 class="mt-4 border-bottom pb-2">Datos Académicos</h5>

                <div class="mt-3">
                    <label>Universidad</label>
                    <select class="form-select" disabled>
                        <option value="1" selected>Universidad Nacional de Jujuy</option>
                    </select>
                    <input type="hidden" th:field="*{idUniversidad}" value="1"/>
                </div>

                <div class="mt-3">
                    <label>Facultad</label>
                    <select class="form-select" th:field="*{idFacultad}" id="facultadSelect" required>
                        <option value="">Seleccione una facultad</option>
                        <option th:each="fac : ${facultades}" th:value="${fac.id}" th:text="${fac.etiqueta}"></option>
                    </select>
                </div>

                <!-- ⭐ ESTE DIV SE ELIMINÓ O MODIFICÓ PARA QUITAR EL INPUT DE BÚSQUEDA ⭐ -->
                <div class="mt-3">
                    <!-- Se ha quitado el input: <input type="text" class="form-control" id="buscadorCarrera" placeholder="Escriba para buscar..."> -->
                    <label for="carreraSelect" class="form-label">Carrera</label>
                    <select class="form-select" th:field="*{idCarrera}" id="carreraSelect" required>
                        <option value="">Seleccione una carrera</option>
                    </select>
                </div>

                <div class="mt-3">
                    <label>Colación</label>
                    <select class="form-select" th:field="*{idColacion}" id="colacionSelect" required>
                        <option value="">Seleccione una colación</option>
                        <th:block th:each="col : ${colaciones}">
                            <option th:value="${col.id}"
                                    th:text="${col.orden + ' (' + #temporals.format(col.fechaColacion, 'dd/MM/yyyy') + ')'}">
                            </option>
                        </th:block>
                    </select>
                </div>

                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" th:field="*{tituloVerificado}" id="tituloVerificado">
                    <label class="form-check-label" for="tituloVerificado">
                        Título Verificado
                    </label>
                </div>

                <input class="form-control mt-3" th:field="*{matricula}" placeholder="Matrícula profesional"/>

                <textarea class="form-control mt-3" th:field="*{intereses}" placeholder="Intereses, proyectos, capacitaciones, hobbies..."></textarea>

                <input class="form-control mt-3" th:field="*{especializaciones}" placeholder="Especializaciones"/>

                <input class="form-control mt-3" th:field="*{idiomas}" placeholder="Idiomas"/>

                <div class="form-group mt-3">
                    <label for="posgradoInput">Posgrado</label>
                    <input type="text" class="form-control" id="posgradoInput" th:field="*{posgrado}" placeholder="Posgrados"/>
                </div>

                <p class="text-muted fst-italic mt-3">* Campo obligatorio</p>
                <button type="submit" class="btn btn-primary mt-4">Registrar Graduado</button>
            </form>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            // Datos de Facultades y Carreras (Cargados localmente)
            const carrerasPorFacultad = {
                "1": [ // Facultad de Ingeniería
                    { id: 101, nombre: "Ingeniería Química" },
                    { id: 102, nombre: "Ingeniería de Minas" },
                    { id: 103, nombre: "Ingeniería Industrial" },
                    { id: 104, nombre: "Ingeniería en Informática" },
                    { id: 105, nombre: "Licenciatura en Sistemas" },
                    { id: 106, nombre: "Licenciatura en Tecnología de los Alimentos" },
                    { id: 107, nombre: "Licenciatura en Ciencias Geológicas" },
                    { id: 108, nombre: "Analista Programador Universitario" },
                    { id: 109, nombre: "Tecnicatura Universitaria en Ciencias de la Tierra" },
                    { id: 110, nombre: "Técnico Universitario en Procesamiento de Minerales" },
                    { id: 111, nombre: "Técnico Universitario en Explotación de Minas" },
                    { id: 112, nombre: "Tecnicatura Universitaria en Perforaciones" },
                    { id: 113, nombre: "Tecnicatura Universitaria en Ciencias de la Tierra Orientada a Petróleo" },
                    { id: 114, nombre: "Tecnicatura Universitaria en Diseño Integral de Videojuegos" }
                ],
                "2": [ // Facultad de Ciencias Agrarias
                    { id: 201, nombre: "Ingeniería Agronómica" },
                    { id: 202, nombre: "Licenciatura en Bromatología" },
                    { id: 203, nombre: "Licenciatura en Ciencias Biológicas" },
                    { id: 204, nombre: "Tecnicatura Universitaria Forestal" },
                    { id: 205, nombre: "Licenciatura en Gestión Ambiental" },
                    { id: 206, nombre: "Licenciatura en Desarrollo Rural" },
                    { id: 207, nombre: "Tecnicatura Universitaria en Transformación de la Producción Agropecuaria" },
                    { id: 208, nombre: "Tecnicatura en Producción de Animales de Granja" },
                    { id: 209, nombre: "Tecnicatura Universitaria en Mecanización Agrícola" },
                    { id: 210, nombre: "Tecnicatura Universitaria en Producción Lechera" },
                    { id: 211, nombre: "Licenciatura en Bromatología - Título Intermedio" }
                ],
                "3": [ // Facultad de Ciencias Económicas
                    { id: 301, nombre: "Contador Público" },
                    { id: 302, nombre: "Licenciatura en Administración" },
                    { id: 303, nombre: "Licenciatura en Economía Política" }
                ],
                "4": [ // Facultad de Humanidades y Ciencias Sociales
                    { id: 401, nombre: "Licenciatura en Antropología" },
                    { id: 402, nombre: "Licenciatura en Comunicación Social" },
                    { id: 403, nombre: "Tecnicatura en Comunicación Digital Convergente" },
                    { id: 404, nombre: "Licenciatura en Educación para la Salud" },
                    { id: 405, nombre: "Profesorado en Educación para la Salud" },
                    { id: 406, nombre: "Licenciatura en Letras" },
                    { id: 407, nombre: "Profesorado en Letras" },
                    { id: 408, nombre: "Licenciatura en Trabajo Social" },
                    { id: 409, nombre: "Profesorado y Licenciatura en Filosofía" },
                    { id: 410, nombre: "Licenciatura en Ciencias de la Educación" },
                    { id: 411, nombre: "Profesorado en Ciencias de la Educación" },
                    { id: 412, nombre: "Licenciatura en Historia" },
                    { id: 413, nombre: "Profesorado en Historia" },
                    { id: 414, nombre: "Licenciatura en Turismo" },
                    { id: 415, nombre: "Tecnicatura en Turismo" },
                    { id: 416, nombre: "Licenciatura en Antropología - Título Intermedio" },
                    { id: 417, nombre: "Licenciatura en Comunicación Social - Título Intermedio" },
                    { id: 418, nombre: "Licenciatura en Educación para la Salud - Título Intermedio" }
                ],
                "5": [ // Escuela Superior de Ciencias de la Salud
                    { id: 501, nombre: "Enfermería Universitaria" }
                ],
                "6": [ // Escuela Superior de Ciencias Jurídicas y Políticas
                    { id: 601, nombre: "Licenciatura en Ciencia Política" }
                ]
            };

            const selectCarrera = document.getElementById("carreraSelect");
            const selectFacultad = document.getElementById("facultadSelect");

            // Valor de carrera actual del DTO (para mantener selección en caso de error)
            const idCarreraActual = [[${altaGraduadoAdminDTO.idCarrera}]] || '';

            /**
             * Carga las carreras basándose únicamente en el ID de la facultad seleccionada.
             * @param {string} facultadId ID de la facultad seleccionada.
             */
            function cargarCarreras(facultadId = "") {
                // Limpiar la selección de carrera
                selectCarrera.innerHTML = '<option value="">Seleccione una carrera</option>';

                const carrerasDeFacultad = carrerasPorFacultad[facultadId] || [];

                // 1. Poblar el select
                carrerasDeFacultad.forEach(c => {
                    const option = document.createElement("option");
                    // Ahora usamos el ID y NO el nombre, ya que los datos hardcodeados lo incluyen
                    option.value = c.id;
                    option.textContent = c.nombre;

                    // Mantener la selección actual si corresponde
                    // Es importante comparar como string ya que los IDs de Carrera vienen del DTO como string (en thymeleaf)
                    if (String(c.id) === String(idCarreraActual)) {
                        option.selected = true;
                    }

                    selectCarrera.appendChild(option);
                });

                if (carrerasDeFacultad.length === 0 && facultadId) {
                    selectCarrera.innerHTML = '<option value="">No se encontraron carreras</option>';
                } else if (!facultadId) {
                    selectCarrera.innerHTML = '<option value="">Seleccione primero una facultad</option>';
                }
            }

            // Evento: Cuando cambia la Facultad, recargar Carreras
            selectFacultad.addEventListener("change", e => {
                const facultadId = e.target.value;
                cargarCarreras(facultadId);
            });

            // Carga inicial
            document.addEventListener('DOMContentLoaded', () => {
                cargarCarreras(selectFacultad.value);
            });
            /*]]>*/
        </script>
    </div>
</div>
</body>
</html>
