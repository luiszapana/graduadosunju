<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Alta Interna de Graduado</title>
</head>
<body>
<div th:replace="~{layout :: layout(~{::content})}">

    <div th:fragment="content">
        <div class="container mt-4">
            <h3>Registro Completo de Graduado (Administración)</h3>

            <form th:action="@{/admin/graduados/guardar}"
                  th:object="${altaGraduadoAdminDTO}"
                  method="post"
                  enctype="multipart/form-data">

                <h5 class="mt-4 border-bottom pb-2">Datos Personales y Acceso</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Email (Usuario de Acceso)</label>
                        <input class="form-control" th:field="*{email}" type="email" required />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>DNI (Contraseña Inicial)</label>
                        <input class="form-control" th:field="*{dni}" type="number" required />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Apellido</label>
                        <input class="form-control" th:field="*{apellido}" required />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>Nombre</label>
                        <input class="form-control" th:field="*{nombre}" required />
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label>Fecha de Nacimiento</label>
                        <input type="date" class="form-control" th:field="*{fechaNacimiento}">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label>Teléfono</label>
                        <input class="form-control" th:field="*{telefono}" type="number" />
                    </div>
                    <div class="col-md-4 mb-3">
                        <label>Celular</label>
                        <input class="form-control" th:field="*{celular}" type="number" />
                    </div>
                </div>

                <h5 class="mt-4 border-bottom pb-2">Dirección</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Provincia</label>
                        <select class="form-select" th:field="*{provinciaId}" required>
                            <option value="">Seleccione una provincia</option>
                            <option th:each="prov : ${provincias}"
                                    th:value="${prov.id}"
                                    th:text="${prov.nombre}"></option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label>Localidad</label>
                        <input type="text" class="form-control" th:field="*{localidad}" placeholder="Escriba la localidad">
                    </div>
                </div>
                <div class="mb-3">
                    <label>Domicilio</label>
                    <input type="text" class="form-control" th:field="*{domicilio}" placeholder="Barrio, calle y número">
                </div>

                <h5 class="mt-4 border-bottom pb-2">Datos Académicos</h5>

                <div class="mt-3">
                    <label>Universidad</label>
                    <select class="form-select" disabled>
                        <option value="1" selected>Universidad Nacional de Jujuy</option>
                    </select>
                    <input type="hidden" th:field="*{idUniversidad}" value="1"/>
                </div>

                <div class="mt-3">
                    <label>Facultad</label>
                    <select class="form-select" th:field="*{idFacultad}" id="facultadSelect" required>
                        <option value="">Seleccione una facultad</option>
                        <option th:each="fac : ${facultades}" th:value="${fac.id}" th:text="${fac.etiqueta}"></option>
                    </select>
                </div>

                <div class="mt-3">
                    <label for="buscadorCarrera" class="form-label">Buscar carrera</label>
                    <input type="text" class="form-control" id="buscadorCarrera" placeholder="Escriba para buscar...">

                    <select class="form-select mt-2" th:field="*{idCarrera}" id="carreraSelect" required>
                        <option value="">Seleccione una carrera</option>
                    </select>
                </div>

                <div class="mt-3">
                    <label>Colación</label>
                    <select class="form-select" th:field="*{idColacion}" id="colacionSelect" required>
                        <option value="">Seleccione una colación</option>
                        <th:block th:each="col : ${colaciones}">
                            <option th:value="${col.id}"
                                    th:text="${col.orden + ' (' + #temporals.format(col.fechaColacion, 'dd/MM/yyyy') + ')'}">
                            </option>
                        </th:block>
                    </select>
                </div>

                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" th:field="*{tituloVerificado}" id="tituloVerificado">
                    <label class="form-check-label" for="tituloVerificado">
                        Título Verificado
                    </label>
                </div>

                <input class="form-control mt-3" th:field="*{matricula}" placeholder="Matrícula profesional"/>

                <textarea class="form-control mt-3" th:field="*{intereses}" placeholder="Intereses, proyectos, capacitaciones, hobbies..."></textarea>

                <input class="form-control mt-3" th:field="*{especializaciones}" placeholder="Especializaciones"/>

                <input class="form-control mt-3" th:field="*{idiomas}" placeholder="Idiomas"/>

                <div class="form-group mt-3">
                    <label for="posgradoInput">Posgrado</label>
                    <input type="text" class="form-control" id="posgradoInput" th:field="*{posgrado}" placeholder="Posgrados"/>
                </div>

                <button type="submit" class="btn btn-primary mt-4">Registrar Graduado</button>
            </form>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script th:inline="javascript">
            const buscador = document.getElementById("buscadorCarrera");
            const selectCarrera = document.getElementById("carreraSelect");
            const selectFacultad = document.getElementById("facultadSelect");

            async function cargarCarreras(filtro = "", facultadId = "") {
                try {
                    const response = await axios.get(/*[[@{/api/carreras}]]*/ "/api/carreras", {
                        params: {
                            query: filtro,
                            facultadId: facultadId
                        }
                    });

                    selectCarrera.innerHTML = '<option value="">Seleccione una carrera</option>';
                    response.data.forEach(c => {
                        const option = document.createElement("option");
                        option.value = c.id;
                        option.textContent = c.nombre;
                        selectCarrera.appendChild(option);
                    });
                } catch (err) {
                    console.error("Error cargando carreras:", err);
                }
            }

            // Evento: Cuando cambia la Facultad, recargar Carreras
            selectFacultad.addEventListener("change", e => {
                const facultadId = e.target.value;
                cargarCarreras(buscador.value, facultadId);
            });

            // Evento: Al escribir en el buscador, recargar Carreras
            buscador.addEventListener("input", e => {
                cargarCarreras(e.target.value, selectFacultad.value);
            });

            // Carga inicial
            cargarCarreras(buscador.value, selectFacultad.value);
        </script>
    </div>
</div>
</body>
</html>