<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Datos académicos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h3>Datos académicos</h3>
    <form th:object="${academicos}" action="/registro/datos-academicos" method="post">
        <input type="hidden" name="loginId" th:value="${loginId}">
        <!-- Campo oculto para el ID de usuario -->
        <input type="hidden" th:field="*{usuarioId}" />

        <!-- Universidad (visible pero deshabilitado) -->
        <select class="form-select" disabled>
            <option value="1" selected>Universidad Nacional de Jujuy</option>
        </select>
        <!-- Campo oculto que realmente viaja en el POST -->
        <input type="hidden" th:field="*{idUniversidad}" value="1"/>

        <!-- Facultades -->
        <select class="form-select mt-3" th:field="*{idFacultad}">
            <option value="">Seleccione una facultad</option>
            <option th:each="fac : ${facultades}" th:value="${fac.id}" th:text="${fac.etiqueta}"></option>
        </select>

        <!-- Carrera con buscador -->
        <div class="mt-3">
            <label for="buscadorCarrera" class="form-label">Buscar carrera</label>
            <input type="text" class="form-control" id="buscadorCarrera" placeholder="Escriba para buscar...">

            <select class="form-select mt-2" th:field="*{idCarrera}" id="carreraSelect" required>
                <option value="">Seleccione una carrera</option>
            </select>
        </div>

        <div class="row">
            <!--<div class="col-md-6 mb-3">
                <label>Título</label>
                <input type="text" class="form-control" id="titulo" readonly>
            </div>-->
            <div class="col-md-6 mb-3">
                <label>Colación</label>
                <select class="form-select" th:field="*{idColacion}" id="colacionSelect">
                    <option value="">Seleccione una colación</option>
                    <th:block th:each="col : ${colaciones}">
                        <option th:value="${col.id}"
                                th:text="${col.facultad.nombre + ' - ' + #temporals.format(col.fechaColacion.toLocalDateTime(), 'dd/MM/yyyy') + ' - ' + col.descripcion}">
                        </option>
                    </th:block>
                </select>
            </div>
        </div>

        <!-- Matrícula -->
        <input class="form-control mt-3" th:field="*{matricula}" placeholder="Matricula profesional"/>

        <!-- Intereses -->
        <textarea class="form-control mt-3" th:field="*{intereses}" placeholder="Intereses, proyectos, capacitaciones, hobbies..."></textarea>

        <!-- Especializaciones -->
        <input class="form-control mt-3" th:field="*{especializaciones}" placeholder="Especializaciones"/>

        <!-- Idiomas -->
        <input class="form-control mt-3" th:field="*{idiomas}" placeholder="Idiomas"/>

        <!-- Posgrado -->
        <div class="form-group mt-3">
            <label for="posgradoInput">Posgrado</label>
            <input type="text" class="form-control" id="posgradoInput" th:field="*{posgrado}" placeholder="Posgrados"/>
        </div>

        <!-- Botón para enviar -->
        <button type="submit" class="btn btn-primary mt-3">Guardar</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    const buscador = document.getElementById("buscadorCarrera");
    const selectCarrera = document.getElementById("carreraSelect");

    async function cargarCarreras(filtro = "") {
        try {
            const response = await axios.get("/api/carreras", { params: { query: filtro } });
            selectCarrera.innerHTML = '<option value="">Seleccione una carrera</option>';
            response.data.forEach(c => {
                const option = document.createElement("option");
                option.value = c.id;
                option.textContent = c.nombre;
                selectCarrera.appendChild(option);
            });
        } catch (err) {
            console.error("Error cargando carreras:", err);
        }
    }

    // primera carga
    cargarCarreras();

    // cada vez que escribe el usuario
    buscador.addEventListener("input", e => {
        cargarCarreras(e.target.value);
    });
</script>
</body>
</html>
